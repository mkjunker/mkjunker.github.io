
<html>
  <head>
    <title>Displaying JSON Data</title>
    <script>
      // https://www.w3schools.com/jsref/met_document_addeventlistener.asp
      window.addEventListener('load',init,false);
      function init(e){
          documentLoader()
          // document.getElementById('myButton').addEventListener('click',documentLoader,false);
      }

      var output = ""

      function tempstr(degc) {
          if (degc === null) {
              return null
          }
          return ((degc * 9 / 5) + 32).toFixed() + " F"
      }

      function windstr(properties) {
          var out = "Wind:";
          if( properties.windDirection.value !== null ) {
              out += " ";
              out += properties.windDirection.value.toString();
          }
          if( properties.windSpeed.value !== null ) {
              out += " ";
              out += (properties.windSpeed.value
                      * 15625 / 25146).toFixed();
              out += " MPH";
          }
          if( properties.windGust.value ) {
              out += " gusting to ";
              out += (properties.windGust.value
                      * 15625 / 25146).toFixed();
              out += " MPH";
          }
          return out;
      }

      function reqListener () {
          // convert the string from the file to an object with JSON.parse
          var obj = JSON.parse(this.responseText);

          var date = new Date(obj.properties.timestamp);
          var now = new Date()
          output += '<p>'
          if ((now - date) > 7200000) {
              output += '<br><font color="red">OLD</font> '
          }
          var data = date.toString().split(' ');
          output += obj.properties.rawMessage.substr(0,4) + ' '
              + data[4].substr(0,5) + ' ' + data[0] + ' '
              + data[1] + ' ' + data[2];
          output += "<br>";
          output += ("Temperature: "
                     + tempstr(obj.properties.temperature.value))
          if (obj.properties.windChill.value !== null) {
              output += ' '
              output += "WC: " + tempstr(obj.properties.windChill.value)
          }
          if (obj.properties.heatIndex.value !== null) {
              output += ' '
              output += "HI: " + tempstr(obj.properties.heatIndex.value)
          }
          if (obj.properties.dewpoint.value !== null) {
              output += ' '
              output += "DP: " + tempstr(obj.properties.dewpoint.value)
          }
          if (obj.properties.relativeHumidity.value !== null) {
              output += ' RH:';
              output +=
                  obj.properties.relativeHumidity.value.toFixed();
              output += '%';
          }
          output += "<br>"
          output += "Conditions: " + obj.properties.textDescription;
          output += " ";
          if( obj.properties.barometricPressure.value !== null ) {
              output += ' Baro: ';
              output += (obj.properties.barometricPressure.value
                         * (152 / 514731)).toFixed(2);
              output += ' inHg';
          }
          output += ' ';
          output += windstr(obj.properties);
          output += "<br>"
          output += ('<font color="green">' + obj.properties.rawMessage
                     + '</font>');
          document.getElementById('output').innerHTML = output + "  $$$"

      }

      function documentLoader(){
          var oReq;
          var stations = ["KMWC", "KETB", "KUES", "KMKE"]
          for(sta in stations)
          {
              oReq = new XMLHttpRequest();
              oReq.onload = reqListener;
              oReq.open("get", "https://api.weather.gov/stations/" + stations[sta] + "/observations/latest", true);
              oReq.send();
          }
      }
    </script>
  </head>
  <body>
    <div id="output"></div>
  </body>
</html>
